!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@angular/router"),require("rxjs/operators"),require("shepherd.js"),require("rxjs")):"function"==typeof define&&define.amd?define("@covalent/guided-tour",["exports","@angular/core","@angular/common","@angular/common/http","@angular/router","rxjs/operators","shepherd.js","rxjs"],t):t(((e=e||self).covalent=e.covalent||{},e.covalent["guided-tour"]={}),e.ng.core,e.ng.common,e.ng.common.http,e.ng.router,e.rxjs.operators,e.Shepherd,e.rxjs)}(this,(function(e,t,o,r,n,i,a,s){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function c(e,t){function o(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function p(e,t,o,r){return new(o||(o=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function h(e,t){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function l(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var f={click:"click",pointerover:"pointerover",keyup:"keyup",added:"added",removed:"removed"};var v=function(){};var b=[f.click,f.pointerover,f.removed,f.added,f.keyup],m=new Map([[13,"enter"],[27,"esc"]]),y={scrollTo:{behavior:"smooth",block:"center"},cancelIcon:{enabled:!0}},T="mat-icon-button material-icons mat-button-base",g=function(e){function t(t){void 0===t&&(t=y);var o=e.call(this)||this;return o.stepOptions=t,o.newTour(),o}return c(t,e),t.prototype.newTour=function(e){var t=this;if(this.shepherdTour=new a.Tour(Object.assign({defaultStepOptions:this.stepOptions},e)),this._destroyedEvent$=new s.Subject,s.merge(s.fromEvent(this.shepherdTour,"cancel"),s.fromEvent(this.shepherdTour,"complete")).pipe(i.first()).subscribe((function(){t._destroyedEvent$.next(),t._destroyedEvent$.complete()})),e&&e.abortOn){var o=[];e.abortOn.forEach((function(e){var r=new s.Subject;o.push(r),t._bindEvent(e,void 0,r,t._destroyedEvent$)}));var r=s.merge.apply(void 0,d(o)).pipe(i.takeUntil(this._destroyedEvent$)).subscribe((function(){t.shepherdTour.complete(),r.unsubscribe()}))}},t.prototype.back=function(){this.shepherdTour.back()},t.prototype.cancel=function(){this.shepherdTour.cancel()},t.prototype.next=function(){this.shepherdTour.next()},t.prototype.finish=function(){this.shepherdTour.complete()},t.prototype.addSteps=function(e){this.shepherdTour.addSteps(this._prepareTour(e))},t.prototype.start=function(){this.shepherdTour.start()},t.prototype._prepareTour=function(e){var t=this,o=new s.Subject,r=new s.Subject,n=!1,a=new s.Subject,u=function(){var e=Array.from(document.querySelectorAll(".shepherd-footer")),t=e[e.length-1],o=document.createElement("span");o.className="shepherd-progress",o.innerText=this.shepherdTour.currentStep.options.count+"/"+c,t.insertBefore(o,t.querySelector(".shepherd-button"))},c=0,p=e.map((function(e){var o,r,n,i;return!0===(null===(o=e.attachToOptions)||void 0===o?void 0:o.skipFromStepCount)?i=function(){}:void 0!==(null===(r=e.attachToOptions)||void 0===r?void 0:r.skipFromStepCount)&&!1!==(null===(n=e.attachToOptions)||void 0===n?void 0:n.skipFromStepCount)||(e.count=++c,i=u.bind(t)),Object.assign({},e,{when:{show:i}})})),h={text:"finish",action:this.finish.bind(this),classes:"mat-button-base mat-button"},l={text:"cancel tour",action:this.cancel.bind(this),classes:"mat-button-base mat-button"};this._destroyedEvent$.pipe(i.first()).subscribe((function(){o.complete(),r.complete(),a.next(),a.complete()}));var f=p.length;return p.forEach((function(u,c){var p={text:"chevron_right",action:function(){r.next(),t.shepherdTour.next()},classes:T},v={text:"chevron_left",action:function(){o.next(),n=!0,u.attachToOptions&&u.attachToOptions.goBackTo?t.shepherdTour.show(u.attachToOptions.goBackTo,!1):t.shepherdTour.back()},classes:T};u.highlightClass=u.attachToOptions&&u.attachToOptions.highlight?"shepherd-highlight":u.highlightClass,u.buttons=0===c?[p]:c===f-1?[v,h]:[v,p];var m=u.advanceOn;("object"==typeof m&&!Array.isArray(m)&&b.indexOf(m.event.split(".")[0])>-1||m instanceof Array)&&(u.advanceOn=void 0,u.buttons=u.advanceOnOptions&&u.advanceOnOptions.allowGoBack?[v,l]:[l]),u.beforeShowPromise=function(){return new Promise((function(h){var f,v=new s.Subject,b=new s.Subject,y=new s.BehaviorSubject(-1);"string"==typeof u.attachTo?f=u.attachTo:"object"==typeof u.attachTo&&"string"==typeof u.attachTo.element&&(f=u.attachTo.element),f?(t.shepherdTour.getCurrentStep()===t.shepherdTour.steps[0]&&t.shepherdTour.getCurrentStep().updateStepOptions({buttons:e[c].advanceOn?[l]:[p]}),y.pipe(i.skip(1),i.takeUntil(s.merge(v.asObservable(),a)),i.skipWhile((function(e){return u.attachToOptions&&void 0!==u.attachToOptions.retries?e<u.attachToOptions.retries:e<20}))).subscribe((function(e){if(b.next(),b.complete(),u.attachToOptions&&u.attachToOptions.skipIfNotFound)if(n)0===t.shepherdTour.steps.indexOf(t.shepherdTour.getCurrentStep())?t.shepherdTour.next():t.shepherdTour.back(),n=!1;else{var o=t.shepherdTour.getCurrentStep();o.destroy(),t.shepherdTour.next(),t.shepherdTour.removeStep(o.id)}else u.attachToOptions&&u.attachToOptions.else?t.shepherdTour.show(u.attachToOptions.else):(console.warn("Retries reached trying to find "+f+". Retried  "+e+" times."),h())})),s.timer(u.attachToOptions&&u.attachToOptions.timeBeforeShow||100,u.attachToOptions&&u.attachToOptions.interval||500).pipe(i.takeUntil(s.merge(v,b,a))).subscribe((function(){document.querySelector(f)?(v.next(),v.complete(),function(){if(m&&!u.advanceOn){Array.isArray(m)||(m=[m]);var e=[];m.forEach((function(o,r){var n=new s.Subject;e.push(n),t._bindEvent(m[r],u.advanceOnOptions,n,a)}));var n=s.forkJoin.apply(void 0,d(e)).pipe(i.takeUntil(s.merge(a,o))).subscribe((function(){u.advanceOnOptions&&u.advanceOnOptions.jumpTo?t.shepherdTour.show(u.advanceOnOptions.jumpTo):t.shepherdTour.next(),r.next(),n.unsubscribe()}))}if(u.abortOn){var c=[];u.abortOn.forEach((function(e){var o=new s.Subject;c.push(o),t._bindEvent(e,void 0,o,a)}));var p=s.merge.apply(void 0,d(c)).pipe(i.takeUntil(s.merge(a,o,r))).subscribe((function(){t.shepherdTour.complete(),p.unsubscribe()}))}}(),h()):y.next(y.value+1)})),a.subscribe((function(){v.next(),v.complete(),b.next(),b.complete()}))):s.timer(u.attachToOptions&&u.attachToOptions.timeBeforeShow||100).pipe(i.takeUntil(s.merge(a))).subscribe((function(){h()}))}))}})),p},t.prototype._bindEvent=function(e,t,o,r){var n=e.selector,a=e.event,u=s.timer(t&&t.timeBeforeShow||100,t&&t.interval||500).pipe(i.takeUntil(r)).subscribe((function(){var e=document.querySelector(n);if(e)if(u.unsubscribe(),a===f.added)o.next(),o.complete();else if(a===f.click||a===f.pointerover||a.indexOf(f.keyup)>-1){var t=a.split(".")[0],c=a.split(".")[1];s.fromEvent(e,t).pipe(i.takeUntil(s.merge(o.asObservable(),r)),i.filter((function(e){return!(e instanceof KeyboardEvent)||m.get(e.keyCode)===c}))).subscribe((function(){o.next(),o.complete()}))}else if(a===f.removed){var p=new MutationObserver((function(){document.body.contains(e)||(o.next(),o.complete(),p.disconnect())}));r.subscribe((function(){p.disconnect()})),p.observe(e,{childList:!0,subtree:!0,attributes:!0})}}))},t}(v);var O=function(e){function o(t,o,r){var a=e.call(this)||this;return a._router=t,a._route=o,a._httpClient=r,a._toursMap=new Map,t.events.pipe(i.filter((function(e){return e instanceof n.NavigationStart&&"popstate"===e.navigationTrigger}))).subscribe((function(e){a.shepherdTour.isActive&&a.shepherdTour.cancel()})),a}return c(o,e),o.prototype.registerTour=function(e,t){return p(this,void 0,void 0,(function(){var o,r;return h(this,(function(n){switch(n.label){case 0:return"string"!=typeof t?[3,2]:[4,this._loadTour(t)];case 1:return r=n.sent(),[3,3];case 2:r=t,n.label=3;case 3:return o=r,this._toursMap.set(e,o),[2]}}))}))},o.prototype.startTour=function(e){var t=this._getTour(e);if(this.finish(),t&&t.steps&&t.steps.length){this.newTour(Object.assign({},t,{steps:void 0}));var o=this.shepherdTour.addSteps(this._configureRoutesForSteps(this._prepareTour(t.steps)));return this.start(),o}console.warn("Tour "+e+" does not exist. Please try another tour.")},o.prototype.initializeOnQueryParams=function(e){var t=this;return void 0===e&&(e="tour"),this._route.queryParamMap.pipe(i.debounceTime(100),i.tap((function(o){var r=o.get(e);if(r){t.startTour(r);var n=new URLSearchParams(window.location.search);n.delete(e);var i=window.location.protocol+"//"+window.location.host+window.location.pathname;n.toString()&&(i+="?"+n.toString()),window.history.replaceState({path:i},"",i)}})))},o.prototype._loadTour=function(e){return p(this,void 0,void 0,(function(){var t;return h(this,(function(o){switch(o.label){case 0:t=this._httpClient.get(e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.pipe(i.map((function(e){return JSON.parse(JSON.stringify(e))}))).toPromise()];case 2:return[2,o.sent()];case 3:return o.sent(),[2,void 0];case 4:return[2]}}))}))},o.prototype._getTour=function(e){return this._toursMap.get(e)},o.prototype._configureRoutesForSteps=function(e){var t=this;return e.forEach((function(e){if(e.routing){var o=e.routing.route;if(e.beforeShowPromise){var r=e.beforeShowPromise;e.beforeShowPromise=function(){return t._router.navigate([o],e.routing.extras).then((function(){return r()}))}}else e.beforeShowPromise=function(){return t._router.navigate([o])}}})),e},o.decorators=[{type:t.Injectable}],o.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:r.HttpClient}]},o}(g);var w=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[o.CommonModule],providers:[O],declarations:[],exports:[]}]}],e}();e.CovalentGuidedTour=g,e.CovalentGuidedTourModule=w,e.CovalentGuidedTourService=O,e.ITourEvent=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=covalent-guided-tour.umd.min.js.map