!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@angular/router"),require("rxjs/operators"),require("shepherd.js"),require("rxjs")):"function"==typeof define&&define.amd?define("@covalent/guided-tour",["exports","@angular/core","@angular/common","@angular/common/http","@angular/router","rxjs/operators","shepherd.js","rxjs"],t):t(((e=e||self).covalent=e.covalent||{},e.covalent["guided-tour"]={}),e.ng.core,e.ng.common,e.ng.common.http,e.ng.router,e.rxjs.operators,e.Shepherd,e.rxjs)}(this,(function(e,t,r,o,n,i,s,a){"use strict";s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function c(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function p(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))}function h(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var f={click:"click",pointerover:"pointerover",keyup:"keyup",added:"added",removed:"removed"};var v=function(){};var b=[f.click,f.pointerover,f.removed,f.added,f.keyup],m=new Map([[13,"enter"],[27,"esc"]]),y={scrollTo:{behavior:"smooth",block:"center"},cancelIcon:{enabled:!0}},T="mat-icon-button material-icons mat-button-base",g=function(e){function t(t){void 0===t&&(t=y);var r=e.call(this)||this;return r.stepOptions=t,r.newTour(),r}return c(t,e),t.prototype.newTour=function(e){var t=this;if(this.shepherdTour=new s.Tour(Object.assign({defaultStepOptions:this.stepOptions},e)),this._destroyedEvent$=new a.Subject,a.merge(a.fromEvent(this.shepherdTour,"cancel"),a.fromEvent(this.shepherdTour,"complete")).pipe(i.first()).subscribe((function(){t._destroyedEvent$.next(),t._destroyedEvent$.complete()})),e&&e.abortOn){var r=[];e.abortOn.forEach((function(e){var o=new a.Subject;r.push(o),t._bindEvent(e,void 0,o,t._destroyedEvent$)}));var o=a.merge.apply(void 0,d(r)).pipe(i.takeUntil(this._destroyedEvent$)).subscribe((function(){t.shepherdTour.complete(),o.unsubscribe()}))}},t.prototype.back=function(){this.shepherdTour.back()},t.prototype.cancel=function(){this.shepherdTour.cancel()},t.prototype.next=function(){this.shepherdTour.next()},t.prototype.finish=function(){this.shepherdTour.complete()},t.prototype.addSteps=function(e){this.shepherdTour.addSteps(this._prepareTour(e))},t.prototype.start=function(){this.shepherdTour.start()},t.prototype._prepareTour=function(e){var t=this,r=new a.Subject,o=new a.Subject,n=!1,s=new a.Subject,u=function(){var e=this.shepherdTour.steps.indexOf(this.shepherdTour.currentStep),t=Array.from(document.querySelectorAll(".shepherd-footer")),r=t[t.length-1],o=document.createElement("span");o.className="shepherd-progress",o.innerText=e+1+"/"+this.shepherdTour.steps.length,r.insertBefore(o,r.querySelector(".shepherd-button"))},c=e.map((function(e){return Object.assign({},e,{when:{show:u.bind(t)}})})),p={text:"finish",action:this.finish.bind(this),classes:"mat-button-base mat-button"},h={text:"cancel tour",action:this.cancel.bind(this),classes:"mat-button-base mat-button"};this._destroyedEvent$.pipe(i.first()).subscribe((function(){r.complete(),o.complete(),s.next(),s.complete()}));var l=c.length;return c.forEach((function(u,c){var f={text:"chevron_right",action:function(){o.next(),t.shepherdTour.next()},classes:T},v={text:"chevron_left",action:function(){r.next(),n=!0,u.attachToOptions&&u.attachToOptions.goBackTo?t.shepherdTour.show(u.attachToOptions.goBackTo,!1):t.shepherdTour.back()},classes:T};u.highlightClass=u.attachToOptions&&u.attachToOptions.highlight?"shepherd-highlight":u.highlightClass,u.buttons=0===c?[f]:c===l-1?[v,p]:[v,f];var m=u.advanceOn;("object"==typeof m&&!Array.isArray(m)&&b.indexOf(m.event.split(".")[0])>-1||m instanceof Array)&&(u.advanceOn=void 0,u.buttons=u.advanceOnOptions&&u.advanceOnOptions.allowGoBack?[v,h]:[h]),u.beforeShowPromise=function(){return new Promise((function(p){var l,v=new a.Subject,b=new a.Subject,y=new a.BehaviorSubject(-1);"string"==typeof u.attachTo?l=u.attachTo:"object"==typeof u.attachTo&&"string"==typeof u.attachTo.element&&(l=u.attachTo.element),l?(t.shepherdTour.getCurrentStep()===t.shepherdTour.steps[0]&&t.shepherdTour.getCurrentStep().updateStepOptions({buttons:e[c].advanceOn?[h]:[f]}),y.pipe(i.skip(1),i.takeUntil(a.merge(v.asObservable(),s)),i.skipWhile((function(e){return u.attachToOptions&&void 0!==u.attachToOptions.retries?e<u.attachToOptions.retries:e<20}))).subscribe((function(e){if(b.next(),b.complete(),u.attachToOptions&&u.attachToOptions.skipIfNotFound)if(n)0===t.shepherdTour.steps.indexOf(t.shepherdTour.getCurrentStep())?t.shepherdTour.next():t.shepherdTour.back(),n=!1;else{var r=t.shepherdTour.getCurrentStep();r.destroy(),t.shepherdTour.next(),t.shepherdTour.removeStep(r.id)}else u.attachToOptions&&u.attachToOptions.else?t.shepherdTour.show(u.attachToOptions.else):(console.warn("Retries reached trying to find "+l+". Retried  "+e+" times."),p())})),a.timer(u.attachToOptions&&u.attachToOptions.timeBeforeShow||100,u.attachToOptions&&u.attachToOptions.interval||500).pipe(i.takeUntil(a.merge(v,b,s))).subscribe((function(){document.querySelector(l)?(v.next(),v.complete(),function(){if(m&&!u.advanceOn){Array.isArray(m)||(m=[m]);var e=[];m.forEach((function(r,o){var n=new a.Subject;e.push(n),t._bindEvent(m[o],u.advanceOnOptions,n,s)}));var n=a.forkJoin.apply(void 0,d(e)).pipe(i.takeUntil(a.merge(s,r))).subscribe((function(){u.advanceOnOptions&&u.advanceOnOptions.jumpTo?t.shepherdTour.show(u.advanceOnOptions.jumpTo):t.shepherdTour.next(),o.next(),n.unsubscribe()}))}if(u.abortOn){var c=[];u.abortOn.forEach((function(e){var r=new a.Subject;c.push(r),t._bindEvent(e,void 0,r,s)}));var p=a.merge.apply(void 0,d(c)).pipe(i.takeUntil(a.merge(s,r,o))).subscribe((function(){t.shepherdTour.complete(),p.unsubscribe()}))}}(),p()):y.next(y.value+1)})),s.subscribe((function(){v.next(),v.complete(),b.next(),b.complete()}))):a.timer(u.attachToOptions&&u.attachToOptions.timeBeforeShow||100).pipe(i.takeUntil(a.merge(s))).subscribe((function(){p()}))}))}})),c},t.prototype._bindEvent=function(e,t,r,o){var n=e.selector,s=e.event,u=a.timer(t&&t.timeBeforeShow||100,t&&t.interval||500).pipe(i.takeUntil(o)).subscribe((function(){var e=document.querySelector(n);if(e)if(u.unsubscribe(),s===f.added)r.next(),r.complete();else if(s===f.click||s===f.pointerover||s.indexOf(f.keyup)>-1){var t=s.split(".")[0],c=s.split(".")[1];a.fromEvent(e,t).pipe(i.takeUntil(a.merge(r.asObservable(),o)),i.filter((function(e){return!(e instanceof KeyboardEvent)||m.get(e.keyCode)===c}))).subscribe((function(){r.next(),r.complete()}))}else if(s===f.removed){var p=new MutationObserver((function(){document.body.contains(e)||(r.next(),r.complete(),p.disconnect())}));o.subscribe((function(){p.disconnect()})),p.observe(e,{childList:!0,subtree:!0,attributes:!0})}}))},t}(v);var O=function(e){function r(t,r,o){var s=e.call(this)||this;return s._router=t,s._route=r,s._httpClient=o,s._toursMap=new Map,t.events.pipe(i.filter((function(e){return e instanceof n.NavigationStart&&"popstate"===e.navigationTrigger}))).subscribe((function(e){s.shepherdTour.isActive&&s.shepherdTour.cancel()})),s}return c(r,e),r.prototype.registerTour=function(e,t){return p(this,void 0,void 0,(function(){var r,o;return h(this,(function(n){switch(n.label){case 0:return"string"!=typeof t?[3,2]:[4,this._loadTour(t)];case 1:return o=n.sent(),[3,3];case 2:o=t,n.label=3;case 3:return r=o,this._toursMap.set(e,r),[2]}}))}))},r.prototype.startTour=function(e){var t=this._getTour(e);if(this.finish(),t&&t.steps&&t.steps.length){this.newTour(Object.assign({},t,{steps:void 0}));var r=this.shepherdTour.addSteps(this._configureRoutesForSteps(this._prepareTour(t.steps)));return this.start(),r}console.warn("Tour "+e+" does not exist. Please try another tour.")},r.prototype.initializeOnQueryParams=function(e){var t=this;return void 0===e&&(e="tour"),this._route.queryParamMap.pipe(i.debounceTime(100),i.tap((function(r){var o=r.get(e);if(o){t.startTour(o);var n=new URLSearchParams(window.location.search);n.delete(e);var i=window.location.protocol+"//"+window.location.host+window.location.pathname;n.toString()&&(i+="?"+n.toString()),window.history.replaceState({path:i},"",i)}})))},r.prototype._loadTour=function(e){return p(this,void 0,void 0,(function(){var t;return h(this,(function(r){switch(r.label){case 0:t=this._httpClient.get(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.pipe(i.map((function(e){return JSON.parse(JSON.stringify(e))}))).toPromise()];case 2:return[2,r.sent()];case 3:return r.sent(),[2,void 0];case 4:return[2]}}))}))},r.prototype._getTour=function(e){return this._toursMap.get(e)},r.prototype._configureRoutesForSteps=function(e){var t=this;return e.forEach((function(e){if(e.routing){var r=e.routing.route;if(e.beforeShowPromise){var o=e.beforeShowPromise;e.beforeShowPromise=function(){return t._router.navigate([r],e.routing.extras).then((function(){return o()}))}}else e.beforeShowPromise=function(){return t._router.navigate([r])}}})),e},r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:o.HttpClient}]},r}(g);var w=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule],providers:[O],declarations:[],exports:[]}]}],e}();e.CovalentGuidedTour=g,e.CovalentGuidedTourModule=w,e.CovalentGuidedTourService=O,e.ITourEvent=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=covalent-guided-tour.umd.min.js.map