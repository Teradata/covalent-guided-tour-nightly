!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@angular/router"),require("rxjs/operators"),require("rxjs"),require("shepherd.js")):"function"==typeof define&&define.amd?define("@covalent/guided-tour",["exports","@angular/core","@angular/common","@angular/common/http","@angular/router","rxjs/operators","rxjs","shepherd.js"],t):t(((e=e||self).covalent=e.covalent||{},e.covalent["guided-tour"]={}),e.ng.core,e.ng.common,e.ng.common.http,e.ng.router,e.rxjs.operators,e.rxjs,e.Shepherd)}(this,(function(e,t,o,r,n,i,s,a){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function c(e,t){function o(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function p(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function h(e,t){var o,r,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function l(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return s}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var f={click:"click",pointerover:"pointerover",keyup:"keyup",added:"added",removed:"removed"};var v=function(){};var b=[f.click,f.pointerover,f.removed,f.added,f.keyup],m=new Map([[13,"enter"],[27,"esc"]]),y={scrollTo:{behavior:"smooth",block:"center"},cancelIcon:{enabled:!0}},T="mat-icon-button material-icons mat-button-base",g=function(e){function t(t){void 0===t&&(t=y);var o=e.call(this)||this;return o.stepOptions=t,o.newTour(),o}return c(t,e),t.prototype.newTour=function(e){var t=this;if(this.shepherdTour=new a.Tour(Object.assign({defaultStepOptions:this.stepOptions},e)),this._destroyedEvent$=new s.Subject,s.merge(s.fromEvent(this.shepherdTour,"cancel"),s.fromEvent(this.shepherdTour,"complete")).pipe(i.first()).subscribe((function(){t._destroyedEvent$.next(),t._destroyedEvent$.complete()})),e&&e.abortOn){var o=[];e.abortOn.forEach((function(e){var r=new s.Subject;o.push(r),t._bindEvent(e,void 0,r,t._destroyedEvent$)}));var r=s.merge.apply(void 0,d(o)).pipe(i.takeUntil(this._destroyedEvent$)).subscribe((function(){t.shepherdTour.complete(),r.unsubscribe()}))}},t.prototype.back=function(){this.shepherdTour.back()},t.prototype.cancel=function(){this.shepherdTour.cancel()},t.prototype.next=function(){this.shepherdTour.next()},t.prototype.finish=function(){this.shepherdTour.complete()},t.prototype.addSteps=function(e){this.shepherdTour.addSteps(this._prepareTour(e))},t.prototype.start=function(){this.shepherdTour.start()},t.prototype._prepareTour=function(e,t){var o=this;void 0===t&&(t="finish");var r=new s.Subject,n=new s.Subject,a=!1,u=new s.Subject,c=function(){var e=Array.from(document.querySelectorAll(".shepherd-footer")),t=e[e.length-1],o=document.createElement("span");o.className="shepherd-progress",o.innerText=this.shepherdTour.currentStep.options.count+"/"+p,t.insertBefore(o,t.querySelector(".shepherd-button"))},p=0,h=e.map((function(e){var t,r,n,i;return!0===(null===(t=e.attachToOptions)||void 0===t?void 0:t.skipFromStepCount)?i=function(){}:void 0!==(null===(r=e.attachToOptions)||void 0===r?void 0:r.skipFromStepCount)&&!1!==(null===(n=e.attachToOptions)||void 0===n?void 0:n.skipFromStepCount)||(e.count=++p,i=c.bind(o)),Object.assign({},e,{when:{show:i}})})),l={text:t,action:this.finish.bind(this),classes:"mat-button-base mat-button"},f={text:"",action:function(){},classes:"shepherd-void-button"};this._destroyedEvent$.pipe(i.first()).subscribe((function(){r.complete(),n.complete(),u.next(),u.complete()}));var v=h.length;return h.forEach((function(t,c){var p={text:"chevron_right",action:function(){n.next(),o.shepherdTour.next()},classes:T},h={text:"chevron_left",action:function(){r.next(),a=!0,t.attachToOptions&&t.attachToOptions.goBackTo?o.shepherdTour.show(t.attachToOptions.goBackTo,!1):o.shepherdTour.back()},classes:T};t.highlightClass=t.attachToOptions&&t.attachToOptions.highlight?"shepherd-highlight":t.highlightClass,t.buttons=0===c?[p]:c===v-1?[h,l]:[h,p];var m=t.advanceOn;("object"==typeof m&&!Array.isArray(m)&&b.indexOf(m.event.split(".")[0])>-1||m instanceof Array)&&(t.advanceOn=void 0,t.buttons=t.advanceOnOptions&&t.advanceOnOptions.allowGoBack?[h,f]:[f]),t.beforeShowPromise=function(){return new Promise((function(h){var l,v=new s.Subject,b=new s.Subject,y=new s.BehaviorSubject(-1);"string"==typeof t.attachTo?l=t.attachTo:"object"==typeof t.attachTo&&"string"==typeof t.attachTo.element&&(l=t.attachTo.element),l?(o.shepherdTour.getCurrentStep()===o.shepherdTour.steps[0]&&o.shepherdTour.getCurrentStep().updateStepOptions({buttons:e[c].advanceOn?[f]:[p]}),y.pipe(i.skip(1),i.takeUntil(s.merge(v.asObservable(),u)),i.skipWhile((function(e){return t.attachToOptions&&void 0!==t.attachToOptions.retries?e<t.attachToOptions.retries:e<20}))).subscribe((function(e){if(b.next(),b.complete(),t.attachToOptions&&t.attachToOptions.skipIfNotFound)if(a)0===o.shepherdTour.steps.indexOf(o.shepherdTour.getCurrentStep())?o.shepherdTour.next():o.shepherdTour.back(),a=!1;else{var r=o.shepherdTour.getCurrentStep();r.destroy(),o.shepherdTour.next(),o.shepherdTour.removeStep(r.id)}else t.attachToOptions&&t.attachToOptions.else?o.shepherdTour.show(t.attachToOptions.else):(console.warn("Retries reached trying to find "+l+". Retried  "+e+" times."),h())})),s.timer(t.attachToOptions&&t.attachToOptions.timeBeforeShow||100,t.attachToOptions&&t.attachToOptions.interval||500).pipe(i.takeUntil(s.merge(v,b,u))).subscribe((function(){document.querySelector(l)?(v.next(),v.complete(),function(){if(m&&!t.advanceOn){Array.isArray(m)||(m=[m]);var e=[];m.forEach((function(r,n){var i=new s.Subject;e.push(i),o._bindEvent(m[n],t.advanceOnOptions,i,u)}));var a=s.forkJoin.apply(void 0,d(e)).pipe(i.takeUntil(s.merge(u,r))).subscribe((function(){t.advanceOnOptions&&t.advanceOnOptions.jumpTo?o.shepherdTour.show(t.advanceOnOptions.jumpTo):o.shepherdTour.next(),n.next(),a.unsubscribe()}))}if(t.abortOn){var c=[];t.abortOn.forEach((function(e){var t=new s.Subject;c.push(t),o._bindEvent(e,void 0,t,u)}));var p=s.merge.apply(void 0,d(c)).pipe(i.takeUntil(s.merge(u,r,n))).subscribe((function(){o.shepherdTour.complete(),p.unsubscribe()}))}}(),h()):y.next(y.value+1)})),u.subscribe((function(){v.next(),v.complete(),b.next(),b.complete()}))):s.timer(t.attachToOptions&&t.attachToOptions.timeBeforeShow||100).pipe(i.takeUntil(s.merge(u))).subscribe((function(){h()}))}))}})),h},t.prototype._bindEvent=function(e,t,o,r){var n=e.selector,a=e.event,u=s.timer(t&&t.timeBeforeShow||100,t&&t.interval||500).pipe(i.takeUntil(r)).subscribe((function(){var e=document.querySelector(n);if(e)if(u.unsubscribe(),a===f.added)o.next(),o.complete();else if(a===f.click||a===f.pointerover||a.indexOf(f.keyup)>-1){var t=a.split(".")[0],c=a.split(".")[1];s.fromEvent(e,t).pipe(i.takeUntil(s.merge(o.asObservable(),r)),i.filter((function(e){return!(e instanceof KeyboardEvent)||m.get(e.keyCode)===c}))).subscribe((function(){o.next(),o.complete()}))}else if(a===f.removed){var p=new MutationObserver((function(){document.body.contains(e)||(o.next(),o.complete(),p.disconnect())}));r.subscribe((function(){p.disconnect()})),p.observe(e,{childList:!0,subtree:!0,attributes:!0})}}))},t}(v);var w={complete:"complete",cancel:"cancel",hide:"hide",show:"show",start:"start",active:"active",inactive:"inactive"};var O=function(e){function o(t,o,r){var s=e.call(this)||this;return s._router=t,s._route=o,s._httpClient=r,s._toursMap=new Map,s._tourStepURLs=new Map,t.events.pipe(i.filter((function(e){return e instanceof n.NavigationStart&&"popstate"===e.navigationTrigger}))).subscribe((function(e){s.shepherdTour.isActive&&s.shepherdTour.cancel()})),s}return c(o,e),o.prototype.tourEvent$=function(e){return s.fromEvent(this.shepherdTour,e)},o.prototype.registerTour=function(e,t){return p(this,void 0,void 0,(function(){var o,r;return h(this,(function(n){switch(n.label){case 0:return"string"!=typeof t?[3,2]:[4,this._loadTour(t)];case 1:return r=n.sent(),[3,3];case 2:r=t,n.label=3;case 3:return o=r,this._toursMap.set(e,o),[2]}}))}))},o.prototype.startTour=function(e){var t=this,o=this._getTour(e);if(this.finish(),o&&o.steps&&o.steps.length){this.newTour(Object.assign({},o,{steps:void 0}));var r=this.shepherdTour.addSteps(this._configureRoutesForSteps(this._prepareTour(o.steps,o.finishButtonText)));return this.tourEvent$(w.show).subscribe((function(e){var o=t._router.url.split(/[?#]/)[0],r=e.step,n=r.id,i=r.options;if(t._tourStepURLs.has(n)){var s=t._tourStepURLs.get(n);s!==o&&t._router.navigate([s])}else i&&i.routing?t._tourStepURLs.set(n,i.routing.route):t._tourStepURLs.set(n,o)})),this.start(),r}console.warn("Tour "+e+" does not exist. Please try another tour.")},o.prototype.initializeOnQueryParams=function(e){var t=this;return void 0===e&&(e="tour"),this._route.queryParamMap.pipe(i.debounceTime(100),i.tap((function(o){var r=o.get(e);if(r){t.startTour(r);var n=new URLSearchParams(window.location.search);n.delete(e);var i=window.location.protocol+"//"+window.location.host+window.location.pathname;n.toString()&&(i+="?"+n.toString()),window.history.replaceState({path:i},"",i)}})))},o.prototype._loadTour=function(e){return p(this,void 0,void 0,(function(){var t;return h(this,(function(o){switch(o.label){case 0:t=this._httpClient.get(e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.pipe(i.map((function(e){return JSON.parse(JSON.stringify(e))}))).toPromise()];case 2:return[2,o.sent()];case 3:return o.sent(),[2,void 0];case 4:return[2]}}))}))},o.prototype._getTour=function(e){return this._toursMap.get(e)},o.prototype._configureRoutesForSteps=function(e){var t=this;return e.forEach((function(e){if(e.routing){var o=e.routing.route;if(e.beforeShowPromise){var r=e.beforeShowPromise;e.beforeShowPromise=function(){return t._router.navigate([o],e.routing.extras).then((function(){return r()}))}}else e.beforeShowPromise=function(){return t._router.navigate([o])}}})),e},o.decorators=[{type:t.Injectable}],o.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:r.HttpClient}]},o}(g);var S=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[o.CommonModule],providers:[O],declarations:[],exports:[]}]}],e}();e.CovalentGuidedTour=g,e.CovalentGuidedTourModule=S,e.CovalentGuidedTourService=O,e.ITourEvent=f,e.TourEvents=w,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=covalent-guided-tour.umd.min.js.map